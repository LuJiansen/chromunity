library(devtools)
load_all()
load_all()
q()
n
load_all()
library(devtools)
load_all()
load_all()
build()
install()
3
q()
c
library(roxygen2)
document()
cmd()
q()
n
library(devtools)
check()
load_all()
check()
load_all()
load_all()
check()
load_all()
check()
load_all()
check()
load_all()
check()
check()
test()
test()
example_gr.path
example_gr
window_gr
test()
which.gr = window_gr
tiles = tiles_gr
k.knn = 25
k.min = 3
this.pc.gr = example_gr
this.pc.gr
class(A)
test()
test()
test()
test()
test()
class(A)
asd = t(A)
class(asd)
dim(asd)
A = A+t(A)
class(A)
t
showMethods("t")
test()
sessionInfo()
check()
check()
check()
check()
check()
check()
example_gr = readRDS("~/git/chromunity/inst/extdata/example_gr.rds")
example_gr
ls()
chromunity(example.gr, which.gr = window_gr, tiles = tiles, k.knn = 25, k.min = 3)
window_gr = readRDS("~/git/chromunity/inst/extdata/window_gr.rds") 
tiles_gr = readRDS("~/git/chromunity/inst/extdata/tiles_gr.rds")
chromunity_out_gr = chromunity(example_gr, which.gr = window_gr, tiles = tiles_gr, k.knn = 25, k.min = 3)
chromunity_out_gr
annotate_c = annotate_multimodal_communities(granges = chromunity_out_gr, which.gr = window_gr)
annotate_c
ls9)
ls()
ls()
final.hcc = readRDS("/gpfs/commons/groups/imielinski_lab/projects/PoreC/db/Final_parquet_HCC1954_Nlaiii_hap_full_updated_3_6.rds")
final.hcc
write.table(final.hcc, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/HCC1954.csv", sep = ",", row.names = FALSE)
gc()
asd = as.data.table(read.table(gzfile("/gpfs/commons/groups/imielinski_lab/data/PoreC/March.2020/nanopolish/GM12878_NlaIII_230ad_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.filtered.read_llr.tsv.gz"), header=T))
asd
dim(asd)
head(asd)
asd = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/March.2020/x_inactivation/x_input/GM12878_NlaIII.hap1.merged.split_pos.tsv")
asd
hap1.meth = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/March.2020/x_inactivation/x_input/GM12878_NlaIII.hap1.merged.split_pos.tsv")
hap2.meth = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/March.2020/x_inactivation/x_input/GM12878_NlaIII.hap2.merged.split_pos.tsv")
asd = eadRDS("/gpfs/commons/groups/imielinski_lab/data/dryclean/TCGA_WGS_PON/germline.status.rds")
asd = readRDS("/gpfs/commons/groups/imielinski_lab/data/dryclean/TCGA_WGS_PON/germline.status.rds")
asd
aln.1 = as.data.table(read.table(gzfile("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/processed_files/data/haplotagged_mapping/GM12878_HindIII_278f2_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz"), header=T))
aln.1
read.table
aln.1 = as.data.table(read.table(gzfile("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/processed_files/data/haplotagged_mapping/GM12878_HindIII_278f2_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz"), header=T, sep = ","))
aln.1
aln.1 = as.data.table(read.table(gzfile("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/processed_files/data/haplotagged_mapping/GM12878_HindIII_278f2_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.contacts.csv.gz"), header=T, sep = ","))
aln.1
pro.1 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/haplotagged_mapping/checklist.csv.pr.chk")
pro.1
head(pro.1)
pro.1 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/haplotagged_mapping/checklist.csv.pr.chk", header = NULL)
pro.1 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/haplotagged_mapping/checklist.csv.pr.chk", header = F)
head(pro.1)
 write.table(pro.1, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/haplotagged_mapping/checklist.pro1.csv", sep = ",", row.names = FALSE)
pro.1[, V1 := NULL]
pro.1
str_split("HG002_NlaIII_bdb7b_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz", sep = "_")
library(stringr)
str_split("HG002_NlaIII_bdb7b_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz", sep = "_")
str_split("HG002_NlaIII_bdb7b_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz", "_")
str_split("HG002_NlaIII_bdb7b_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz", "_")[[1]][1]
por.1[, smp := str_split("HG002_NlaIII_bdb7b_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz", "_")[[1]][1]]
pro.1[, smp := str_split("HG002_NlaIII_bdb7b_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz", "_")[[1]][1]]
pro.1
pro.1[, smp := str_split(V2, "_")[[1]][1]]
pro.1
pro.1[, smp := lapply(str_split(V2, "_")[[1]][1])]
lapply
?lapply
pro.1[, smp := lapply(V2, str_split(pattern =  "_")[[1]][1])]
pro.1[, c("smp") := tstrsplit(V2, "_", fixed=TRUE)]
pro.1[, c("smp") := rep(tstrsplit(V2, "_", fixed=TRUE))]
rep
pro.1[, c("smp") := rep(tstrsplit(V2, "_"))]
tstrsplit
pro.1[, smp := rep(tstrsplit(V2, "_"))]
pro.1[, smp := tstrsplit(V2, "_", fixed=TRUE)[[1]][1]]
pro.1
tstrsplit("HG002_NlaIII_bdb7b_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz", "_", fixed=TRUE)
tstrsplit("HG002_NlaIII_bdb7b_GRCh38_bwa_0.7.17_sensitive_GIABhiconf_whatshap_0.19.c01520_default.fragment_alignments.csv.gz", "_", fixed=TRUE)[[1]][1]
pro.1[, smp := tstrsplit(V2, "_")[[1]][1]]
pro.1
pro.1[,.(tstrsplit(V2, "_")[[1]][1])]
pro.1[,.(tstrsplit(V2, "_"))]
pro.1[,.(tstrsplit(V2, "_")[[1]])]
pro.1[, smp := tstrsplit(V2, "_")[[1]]]
pro.1
pro.1.d = dcast.data.table(pro.1,  smp~V2)
pro.1.dv
pro.1.d
pro.1.d[1]
pro.1.d[1,1]
pro.1.d[1,1:2]
pro.1.d[1,2]
pro.1.d = dcast.data.table(pro.1,  smp~V2, value.var = "V2")
pro.1.d[1,1:2]
pro.1.d = dcast.data.table(pro.1,  smp~., value.var = "V2")
pro.1.d[1,1:2]
pro.1.d = dcast.data.table(pro.1,  smp~V2, value.var = "V2")
dim(pro.a.d)
dim(pro.1.d)
write.table(pro.1.d, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/haplotagged_mapping/checklist.decast.pro1.csv", sep = ",", row.names = FALSE)
pro.1 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/haplotagged_mapping/checklist.mcool.chk")
pro.1 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/cooler/checklist.mcool.chk")
pro.1
pro.1 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/cooler/checklist.mcool.chk", header = F)
pro.1
write.table(pro.1, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/cooler/checklist.mcool.csv", sep = ",", row.names = FALSE)
pro.1[, V1 := NULL]
pro.1[, smp := tstrsplit(V2, "_")[[1]]]
pro.1
pro.1.d = dcast.data.table(pro.1,  smp~V2, value.var = "V2")
pro.1.d
write.table(pro.1.d, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/cooler/checklist.mcool.dcast.csv", sep = ",", row.names = FALSE)
asd1 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/cooler/checklist.mcool.dcast.csv")
asd1
asd1 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/cooler/checklist.mcool.csv")
asd1
asd2 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/haplotagged_mapping/checklist.csv.pr.chk")
asd2
asd = rbind(asd1, asd2)
head(asd1)
head(asd2)
asd2 = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/haplotagged_mapping/checklist.pro1.csv")
head(asd2)
asd = rbind(asd1, asd2)
asd
write.table(asd, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/checklist.csv", sep = ",", row.names = FALSE)
asd
asd[order(V2)]
asd[order(V2)][1:3]
asd = asd[order(V2)]
write.table(asd, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/checklist.csv", sep = ",", row.names = FALSE)
ls()
asd1
hap1.meth
hap2.meth
hap2.meth = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/March.2020/x_inactivation/x_input/GM12878_NlaIII.hap2.merged.split_pos.tsv")
hap1.meth = fread("/gpfs/commons/groups/imielinski_lab/data/PoreC/March.2020/x_inactivation/x_input/GM12878_NlaIII.hap1.merged.split_pos.tsv")
hap1.mrh
hap1.meth
write.table(hap1.meth, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/methylation/GM12878_methylation_hap1.csv", sep = ",", row.names = FALSE)
write.table(hap2.meth, "/gpfs/commons/groups/imielinski_lab/data/PoreC/Apr.2020/fastq_sra/geo_processed/data/methylation/GM12878_methylation_hap2.csv", sep = ",", row.names = FALSE)
ls()
asd1
ls()
q()
n
library(devtools)
load_all(OP
load_all()
shave_concatemers
load_all()
test()
test()
setwd("/gpfs/commons/home/adeshpande/git/chromunity")
library(devtools)
test()
test()
test()
check()
check()
overlapsRanges
showMethods("overlapsRanges")
check()
example_gr
this.chrom
q()
n
library(chromunity)   
source("/gpfs/commons/home/adeshpande/git/chromunity/R/chromunity.R")
source("/gpfs/commons/home/adeshpande/git/chromunity/R/chromunity.R")
library(gUtils)
importFrom Matrix sparseMatrix 
importFrom("Matrix", "sparseMatrix ")
importFrom("Matrix", "sparseMatrix")
library(Matrix, include.only = 'sparseMatrix')
concatemers = example_gr; resolution = 1e5; region = si2gr(concatemers); windows = NULL; piecewise = TRUE; shave = FALSE; bthresh = 3; cthresh = 3; max.size = 2^31-1; subsample.frac = NULL; window.size = 5e6; max.slice = 1e6; min.support = 5; stride = window.size/2; mc.cores = 5; k.knn = 25; k.min = 5; pad = 1e3; peak.thresh = 0.85; seed = 42; verbose = TRUE
windows
if (piecewise)
    {
        ##cc = pbmclapply(winids, mc.cores = mc.cores, mc.preschedule = TRUE, function(win)
        cc = mclapply(winids, mc.cores = mc.cores, mc.preschedule = TRUE, function(win)
        {
            ## print(win)
            suppressWarnings({
                these.bins = binmap[.(win), ]
                cc = concatemer_communities(concatemers %Q% (binid %in% these.bins$binid), k.knn = k.knn, max.size = max.size, k.min = k.min, seed = seed, verbose = verbose>1)
                if (length(cc))
                {
                    cc = cc[cc$support >= min.support] 
                    cc$winid = win
                }
            })
            cc
        })
        
        cc = cc %>% do.call(grbind, .)
    }
  else ## we shave 
  {
    if (shave)
    {
      if (verbose)
        cmessage('Shaving concatemers with bthresh = ', bthresh, ' and cthresh = ', cthresh)
      concatemers = shave_concatemers(concatemers, bthresh = bthresh, cthresh = cthresh, verbose = verbose)
    }

cc = mclapply(winids, mc.cores = mc.cores, mc.preschedule = TRUE, function(win)
        {
            ## print(win)
            suppressWarnings({
                these.bins = binmap[.(win), ]
                cc = concatemer_communities(concatemers %Q% (binid %in% these.bins$binid), k.knn = k.knn, max.size = max.size, k.min = k.min, seed = seed, verbose = verbose>1)
                if (length(cc))
                {
                    cc = cc[cc$support >= min.support] 
                    cc$winid = win
                }
            })
            cc
        })
        
        cc = cc %>% do.call(grbind, .)
winids
cc = mclapply(winids, mc.cores = mc.cores, mc.preschedule = TRUE, function(win)
        {
            ## print(win)
            suppressWarnings({
                these.bins = binmap[.(win), ]
                cc = concatemer_communities(concatemers %Q% (binid %in% these.bins$binid), k.knn = k.knn, max.size = max.size, k.min = k.min, seed = seed, verbose = verbose>1)
                if (length(cc))
                {
                    cc = cc[cc$support >= min.support] 
                    cc$winid = win
                }
            })
            cc
        })
        
        cc = cc %>% do.call(grbind, .)
cc
ncat
nbin
uchid
this.chid = 14
check()
quir()
quit()
n
library(dev.tools)
library(devtools)
check()
check()
binsets = example_chrom$binsets; concatemers = example_chrom$concatemers; background.binsets = NULL; model = NULL; covariates = NULL; annotated.binsets = example_annot; k = 5; gg = NULL; theta = NULL; mc.cores = 5; verbose = TRUE; resolution = 1e5; maxit = 10
model
model$theta   
model$model$theta   
ubid
res
check()
check()
check()
check()
load_all()
load_all()
getwd()
chaeck()
chaeck()
check()
check()
document()
q()
n
